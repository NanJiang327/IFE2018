<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>我是精明的小卖家（一)</title>
	<style>
		.box{
			width: 800px;
			margin: 0 auto;
			padding: 10px;
			border: 1px solid seagreen;
		}

		.sub-title{
			font-size: 20px;
		}

		table.dataintable {
			margin-top:15px;
			border-collapse:collapse;
			border:1px solid #aaa;
			width:100%;
		}

		table.dataintable th {
			vertical-align:baseline;
			padding:5px 15px 5px 6px;
			background-color:#3F3F3F;
			border:1px solid #3F3F3F;
			text-align:left;
			color:#fff;
		}

		table.dataintable td {
			vertical-align:text-top;
			padding:6px 15px 6px 6px;
			border:1px solid #aaa;
		}

		table.dataintable tr:nth-child(odd) {
			background-color:#F5F5F5;
		}

		table.dataintable tr:nth-child(even) {
			background-color:#fff;
		}

	</style>
</head>
<body>
	<div class="box">
		<div id="area">
			<p class="sub-title">地区</p>
			<input type="checkbox" name="area" value="huabei" /> 华北
			<input type="checkbox" name="area" value="huanan" /> 华南
			<input type="checkbox" name="area" value="huadong" /> 华东
			<input type="checkbox" name="areaAll" value="area-all" /> 全选
		</div>
		<div id="product">
			<p class="sub-title">产品</p>
			<input type="checkbox" name="product" value="mobile" /> 手机
			<input type="checkbox" name="product" value="laptop" /> 笔记本
			<input type="checkbox" name="product" value="speaker" /> 智能音箱
			<input type="checkbox" name="productAll" value="product-all" /> 全选
		</div>
		<div id="table-wrapper">
		</div>
	</div>
	<script src="ife31data.js"></script>
	<script>
		var tableWrapper = document.querySelector('#table-wrapper');
		var area = document.querySelector('#area');
		var areaBtn = area.getElementsByTagName('input');
		var product = document.querySelector('#product');
		var productBtn = product.getElementsByTagName('input');
		var selectedProduct = [];
		var selectedArea = [];
		var clickedBtns = {
			area: {
				'华北': false,
				'华南': false,
				'华东': false
			},
			product: {
				'手机': false,
				'笔记本': false,
				'智能音箱': false
			}
		};

		area.addEventListener('click',function () {
			var ev = ev || window.event;
			var target = ev.target || ev.srcElement;
			if (target.nodeName.toLowerCase() === 'input') {
				switch (target.value) {
					case 'huabei':
						clickedItems('area','华北',target.checked);
						break;
					case 'huanan':
						clickedItems('area','华南',target.checked);
						break;
					case 'huadong':
						clickedItems('area','华东',target.checked);
						break;
					case 'area-all':
						if (target.checked){
							checkAll(areaBtn);
						} else{
							uncheckAll(areaBtn);
						}
						break;
					default:
						break;
				}
				if (checkSelectedAll(areaBtn)){
					checkAll(areaBtn);
				}
				addToTable();
			}
		})

		product.addEventListener('click',function () {
			var ev = ev || window.event;
			var target = ev.target || ev.srcElement;
			if (target.nodeName.toLowerCase() === 'input'){
					switch (target.value){
						case 'mobile':
							clickedItems('product','手机',target.checked);
							break;
						case 'laptop':
							clickedItems('product','笔记本',target.checked);
							break;
						case 'speaker':
							clickedItems('product','智能音箱',target.checked);
							break;
						case 'product-all':
							if (target.checked){
								checkAll(productBtn);
							} else{
								uncheckAll(productBtn);
							}
							break;
						default:
							break;
					}
				if (checkSelectedAll(productBtn)){
					checkAll(productBtn);
				}
				addToTable();
			}
		})

		function getSelectedBtns() {
			// 获取area中选中的选项
			for (var i in clickedBtns.area) {
				if (clickedBtns.area[i]) {
					if (selectedArea.indexOf(i) < 0){
						selectedArea.push(i);
					}

				}else{
					if (selectedArea.indexOf(i) >= 0){
						selectedArea.splice(selectedArea.indexOf(i), 1);
					}
				}
			}
			// 获取product中选中的选项
			for (var i in clickedBtns.product){
				if (clickedBtns.product[i]) {
					if (selectedProduct.indexOf(i) < 0){
						selectedProduct.push(i);
					}
				}else{
					if (selectedProduct.indexOf(i) >= 0){
						selectedProduct.splice(selectedProduct.indexOf(i), 1);
					}
				}
			}
		}

		function addToTable() {
			var str = '',
				product = '',
				sale = [],
				region = '',
				table = '<table class="dataintable"><tr><th>商品</th><th>地区</th><th>1月</th><th>2月</th><th>3月</th><th>4月</th><th>5月</th><th>6月</th><th>7月</th><th>8月</th><th>9月</th><th>10月</th><th>11月</th><th>12月</th></tr>';
			getSelectedBtns();
			if (selectedProduct.length === 0&& selectedArea.length === 0){
				return tableWrapper.innerHTML = '';
			} else {
				var productL = selectedProduct.length;
				var areL = selectedArea.length;
				for (var i in sourceData){
					sale = sourceData[i].sale;
					region = sourceData[i].region;
					product = sourceData[i].product;
					if (productL > 0 && areL > 0){
						if (selectedProduct.indexOf(sourceData[i].product) >= 0 && selectedArea.indexOf(sourceData[i].region) >= 0){
							str += '<tr><td class="head">'+product+'</td><td>'+region+'</td><td>'+sale[0]+'</td><td>'+sale[1]+'</td><td>'+sale[2]+'</td><td>'+sale[3]+'</td><td>'+sale[4]+'</td><td>'+sale[5]+'</td><td>'+sale[6]+'</td><td>'+sale[7]+'</td><td>'+sale[8]+'</td><td>'+sale[9]+'</td><td>'+sale[10]+'</td><td>'+sale[11]+'</td></tr>';
						}
					} else if (productL > 0 && areL === 0){
						if (selectedProduct.indexOf(sourceData[i].product) >= 0){
							str += '<tr><td class="head">'+product+'</td><td>'+region+'</td><td>'+sale[0]+'</td><td>'+sale[1]+'</td><td>'+sale[2]+'</td><td>'+sale[3]+'</td><td>'+sale[4]+'</td><td>'+sale[5]+'</td><td>'+sale[6]+'</td><td>'+sale[7]+'</td><td>'+sale[8]+'</td><td>'+sale[9]+'</td><td>'+sale[10]+'</td><td>'+sale[11]+'</td></tr>';
						}
					} else if (areL > 0 && productL === 0){
						if (selectedArea.indexOf(sourceData[i].region) >= 0){
							str += '<tr><td class="head">'+region+'</td><td>'+product+'</td><td>'+sale[0]+'</td><td>'+sale[1]+'</td><td>'+sale[2]+'</td><td>'+sale[3]+'</td><td>'+sale[4]+'</td><td>'+sale[5]+'</td><td>'+sale[6]+'</td><td>'+sale[7]+'</td><td>'+sale[8]+'</td><td>'+sale[9]+'</td><td>'+sale[10]+'</td><td>'+sale[11]+'</td></tr>';
						}
					}
				}
				table += str;
				return tableWrapper.innerHTML = table + '</table>';
			}
		}

		function clickedItems(type, targetValue, checked) {
			if (checked){
				if (type === 'area'){
					clickedBtns.area[targetValue] = true;
				}else{
					clickedBtns.product[targetValue] = true;
				}
			} else {
				if (type === 'area'){
					clickedBtns.area[targetValue] = false;
				}else{
					clickedBtns.product[targetValue] = false;
				}
			}
		}

		function checkAllItems(obj) {
			if (obj === areaBtn){
				for (var i in clickedBtns.area){
					clickedBtns.area[i] = true;
				}
			} else{
				for (var i in clickedBtns.product){
					clickedBtns.product[i] = true;
				}
			}
		}

		function uncheckAllItems(obj) {
			if (obj === areaBtn){
				for (var i in clickedBtns.area){
					clickedBtns.area[i] = false;
				}
			} else{
				for (var i in clickedBtns.product){
					clickedBtns.product[i] = false;
				}
			}
		}

		function checkAll(obj) {
			for (var i in obj){
				obj[i].checked = true;
			}
			checkAllItems(obj);
		}

		function uncheckAll(obj) {
			for (var i in obj){
				obj[i].checked = false;
			}
			uncheckAllItems(obj);
		}

		function checkSelectedAll(obj){
			for (var i = 0; i < obj.length; i++){
				if (i === 3){
					break;
				}

				if (!obj[i].checked){
					obj[3].checked = false;
					return false;
				}
			}
			return true;
		}
	</script>
</body>
</html>